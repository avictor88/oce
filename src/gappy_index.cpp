/* vim: set expandtab shiftwidth=2 softtabstop=2 tw=70: */

#include <Rcpp.h>
using namespace Rcpp;

// Cross-reference work:
// 1. update ../src/registerDynamicSymbol.c with an item for this
// 2. main code should use the autogenerated wrapper in ../R/RcppExports.R
//
// [[Rcpp::export]]
IntegerVector do_gappy_index(IntegerVector starts, IntegerVector offset, IntegerVector length)
{
    long unsigned int nstarts = starts.size();
    long unsigned int n = nstarts * length[0];
    long unsigned int k = 0;
    IntegerVector res(n);
    if (nstarts > 0) {
      long unsigned int minspan = 100 * nstarts * length[0]; // start large
      for (long unsigned int i = 1; i < nstarts; i++) {
        long unsigned span = starts[i] - starts[i-1];
        if (span < minspan)
          minspan = span;
      }
      if (length[0] > minspan)
        ::Rf_error("'length' %d exceeds minimum span between 'starts' elements (%d)", length[0], minspan);
    }
    for (long unsigned int i = 0; i < nstarts; i++) {
      long unsigned off = offset[0];
      for (long unsigned int j = 0; j < length[0]; j++) {
        res[k++] = starts[i] + off;
        off++;
        if (k > n) {
          break;
        }
      }
    }
    return res;
}

